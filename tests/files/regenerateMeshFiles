#!/bin/bash

# Script to regenerate all meshes for tests based on the the source files in the
# 'sources' directory. It should be invoked as `regenerateMeshFiles [PREPROCESSOR]`.

if [ "$#" -ne 1 ];
then
  echo "Error expected the path to the preprocessor as argument"
  exit 1
fi
if [ ! -x "$1" ]
then
  echo "Can not execute the preprocessor at '$1'"
  exit 1
fi

PREPROCESSOR="$1"

# Structured meshes generated by the preprocessor
for meshSource in sources/*.hpgem
do
  echo "Meshing ${meshSource}"
  filename=$(basename -- "$meshSource")
  # Name munching
  filename=${filename/source/mesh};
  filename=${filename/Source/Mesh};
  "$PREPROCESSOR" --inFile "$meshSource" --outFile "$filename"
done

# Centaur meshes
for meshSource in sources/*.hyb
do
  echo "Meshing ${meshSource}"
  filename=$(basename -- "$meshSource")
  # Replacing extension hyb -> hpgem
  filename="${filename%hyb}hpgem"
  "$PREPROCESSOR" --inFile "$meshSource" --outFile "$filename"
done
